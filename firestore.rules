rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    
    // ===============================
    // FUNCIONES AUXILIARES DE VALIDACIÓN SIMPLIFICADAS
    // ===============================
    
    // Función para validar que un userId es válido
    function isValidUserId(userId) {
      return userId is string && userId.size() > 0 && userId.size() < 200;
    }
    
    // Función para validar que un displayName es válido
    function isValidDisplayName(name) {
      return name is string && name.size() > 0 && name.size() <= 100;
    }
    
    // Función para validar tipos de juegos válidos
    function isValidGameType(gameType) {
      return gameType in ['pasalache', 'quiensabemas', 'mentiroso', 'crackrapido', 'pasala-che', 'quien-sabe-mas', 'crack-rapido'];
    }
    
    // ===============================
    // REGLAS PARA USUARIOS - MÁS PERMISIVAS
    // ===============================
    match /users/{userId} {
      // Permitir lectura completa para rankings públicos
      allow read: if true;
      
      // Permitir escritura amplia para estadísticas de juegos
      allow create, update: if true;
      allow delete: if false;
    }
    
    // ===============================
    // REGLAS PARA PARTIDAS/MATCHES - MÁS PERMISIVAS
    // ===============================
    match /matches/{matchId} {
      // Permitir lectura completa para historiales
      allow read: if true;
      
      // Permitir escritura amplia para guardar partidas
      allow create, update: if true;
      allow delete: if false;
    }
    
    // ===============================
    // REGLAS PARA RANKINGS - COMPLETAMENTE PERMISIVAS
    // ===============================
    match /rankings/{rankingId} {
      allow read, write: if true;
    }
    
    // Rankings específicos por juego - más permisivos
    match /rankings_mentiroso/{rankingId} {
      allow read, write: if true;
    }
    
    match /rankings_quiensabemas/{rankingId} {
      allow read, write: if true;
    }
    
    match /rankings_crackrapido/{rankingId} {
      allow read, write: if true;
    }
    
    match /rankings_pasalache/{rankingId} {
      allow read, write: if true;
    }
    
    // ===============================
    // REGLAS PARA HISTORIAL DE PARTIDAS - PERMISIVAS
    // ===============================
    match /history_mentiroso/{historyId} {
      allow read, write: if true;
    }
    
    match /history_quiensabemas/{historyId} {
      allow read, write: if true;
    }
    
    match /history_crackrapido/{historyId} {
      allow read, write: if true;
    }
    
    match /history_pasalache/{historyId} {
      allow read, write: if true;
    }
    
    // ===============================
    // REGLAS PARA LOGROS - PERMISIVAS
    // ===============================
    match /achievements/{achievementId} {
      allow read, write: if true;
    }
    
    // ===============================
    // REGLAS PARA CONFIGURACIÓN DEL JUEGO
    // ===============================
    match /gameConfig/{configId} {
      allow read: if true;
      allow write: if true; // Más permisivo para desarrollo
    }
    
    // ===============================
    // REGLAS PARA SALAS MULTIJUGADOR - PERMISIVAS
    // ===============================
    match /rooms/{roomId} {
      allow read, write: if true;
    }
    
    // ===============================
    // REGLAS PARA ESTADÍSTICAS DE JUEGOS
    // ===============================
    match /game_stats/{statId} {
      allow read, write: if true;
    }
    
    // Estadísticas por usuario
    match /user_stats/{userId} {
      allow read, write: if true;
    }
    
    // ===============================
    // REGLAS PARA SESIONES Y DATOS TEMPORALES
    // ===============================
    match /sessions/{sessionId} {
      allow read, write: if true;
    }
    
    match /temp_data/{dataId} {
      allow read, write: if true;
    }
    
    // ===============================
    // REGLA GENERAL MUY PERMISIVA PARA DESARROLLO
    // ===============================
    match /{document=**} {
      allow read, write: if true;
    }
  }
}

// NOTAS PARA IMPLEMENTACIÓN:
// 1. Estas reglas son muy permisivas para facilitar el desarrollo
// 2. En producción, se recomienda ser más restrictivo
// 3. La autenticación anónima debe estar habilitada en Firebase Console
// 4. Para aplicar: Firebase Console > Firestore Database > Rules > Copiar y Publicar