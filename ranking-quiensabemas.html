<!DOCTYPE html>
<html lang="es">
<head>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('consent', 'default', {
      'ad_storage': 'denied',
      'analytics_storage': 'denied',
      'ad_user_data': 'denied',
      'ad_personalization': 'denied',
      'functionality_storage': 'denied',
      'personalization_storage': 'denied',
      'security_storage': 'granted',
      'wait_for_update': 500
    });
    gtag('set', 'ads_data_redaction', true);
    gtag('set', 'url_passthrough', true);
    
    // Specify region
    gtag('set', 'region', 'ES');
  </script>
    <meta charset="UTF-8" />
    <meta name="description" content="Ranking de Quién Sabe más en Crack Total. Los jugadores más inteligentes en duelos de conocimiento.">
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="google-adsense-account" content="ca-pub-9579152019412427">
    <title>Ranking Quién Sabe más - Crack Total</title>
    <link rel="icon" href="/portada.ico" type="image/x-icon">
    <link rel="canonical" href="https://cracktotal.com/ranking-quiensabemas.html">
    <link rel="alternate" hreflang="es" href="https://cracktotal.com/ranking-quiensabemas.html" />

    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://cracktotal.com/ranking-quiensabemas.html">
    <meta property="og:title" content="Ranking Quién Sabe más - Crack Total">
    <meta property="og:description" content="¿Sos el más inteligente? Mirá el Ranking de Quién Sabe más y competí para demostrar tu conocimiento.">
    <meta property="og:image" content="https://cracktotal.com/assets/images/portada.jpg">

    <!-- Twitter -->
    <meta property="twitter:card" content="summary_large_image">
    <meta property="twitter:url" content="https://cracktotal.com/ranking-quiensabemas.html">
    <meta property="twitter:title" content="Ranking Quién Sabe más - Crack Total">
    <meta property="twitter:description" content="¿Sos el más inteligente? Mirá el Ranking de Quién Sabe más y competí para demostrar tu conocimiento.">
    <meta property="twitter:image" content="https://cracktotal.com/assets/images/portada.jpg">
    <meta property="twitter:site" content="@cracktotal_">

    <!-- CSS Links -->
    <link rel="stylesheet" href="assets/css/styles.css" />
    <link rel="stylesheet" href="assets/css/base.css">
    <link rel="stylesheet" href="assets/css/layout.css">
    <link rel="stylesheet" href="assets/css/ranking.css">
    <link rel="stylesheet" href="assets/css/ranking-modern.css">
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;600;700;800&family=Oswald:wght@400;700&display=swap" rel="stylesheet">
    <script src="https://www.google-analytics.com/analytics.js" async></script>

    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-5XP3T1RTH7"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
    
      gtag('config', 'G-5XP3T1RTH7');
    </script>

    <!-- Schema.org Markup for WebPage -->
    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "WebPage",
      "name": "Ranking Quién Sabe más - Crack Total",
      "description": "Consulta el Ranking de Quién Sabe más en Crack Total. Mirá quiénes son los jugadores más inteligentes en este duelo de conocimientos.",
      "url": "https://cracktotal.com/ranking-quiensabemas.html",
      "publisher": {
        "@type": "Organization",
        "name": "Crack Total",
        "logo": {
          "@type": "ImageObject",
          "url": "https://cracktotal.com/assets/images/logo.png"
        }
      }
    }
    </script>

    <script src="assets/js/main.js"></script>
    
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-auth-compat.js"></script>
    
    <!-- Firebase Unificado -->
    <script src="assets/js/firebase-unified.js"></script>
</head>
<body class="ranking-page-body">
    <!-- Skip Link para accesibilidad -->
    <a href="#main-content" class="skip-link">Saltar al contenido principal</a>
    
    <nav class="main-navigation" role="navigation" aria-label="Navegación principal">
        <a href="index.html" class="nav-logo" aria-label="Crack Total - Inicio">
            Crack Total <i class="fas fa-futbol" aria-hidden="true"></i>
        </a>
        <button class="nav-toggle" aria-label="Abrir menú de navegación" aria-expanded="false">
            <i class="fas fa-bars" aria-hidden="true"></i>
        </button>
        <ul>
            <li><a href="index.html" aria-label="Ir al inicio"><i class="fas fa-home" aria-hidden="true"></i> Inicio</a></li>
            <li><a href="games.html" aria-label="Ir a los juegos"><i class="fas fa-gamepad" aria-hidden="true"></i> Juegos</a></li>
            <li><a href="profile.html" aria-label="Ver mi perfil"><i class="fas fa-user" aria-hidden="true"></i> Perfil</a></li>
            <li><a href="ranking.html" aria-label="Ver ranking general"><i class="fas fa-trophy" aria-hidden="true"></i> Rankings</a></li>
            <li><a href="logros.html" aria-label="Ver mis logros"><i class="fas fa-medal" aria-hidden="true"></i> Logros</a></li>
            <li><a href="blog.html" aria-label="Leer el blog"><i class="fas fa-blog" aria-hidden="true"></i> Blog</a></li>
            <li><a href="about.html" aria-label="Acerca de nosotros"><i class="fas fa-info-circle" aria-hidden="true"></i> Acerca de</a></li>
            <li><a href="contact.html" aria-label="Contactar con nosotros"><i class="fas fa-envelope" aria-hidden="true"></i> Contacto</a></li>
        </ul>
    </nav>
    

    <!-- App Header -->
    <header class="app-header">
        <a href="index.html" class="home-link" aria-label="Volver al Inicio">
            <i class="fas fa-home"></i>
            <span>Inicio</span>
        </a>
        <div class="logo-animation">
             <i class="fas fa-brain ball-icon"></i>
        </div>
        <a href="games.html" class="title-link">
             <h1 class="title-text">Crack Total</h1>
        </a>
        <p class="subtitle">🧠 Ranking Quién Sabe más - Los más Inteligentes</p>
    </header>

    <!-- Main Content -->
    <main class="game-content" id="main-content">
        <!-- Navegación entre rankings -->
        <div class="navigation-buttons">
            <a href="profile.html" class="nav-button">
                <i class="fas fa-user"></i> Mi Perfil
            </a>
            <a href="ranking.html" class="nav-button">
                <i class="fas fa-trophy"></i> Pasala Che
            </a>
            <a href="ranking-mentiroso.html" class="nav-button mentiroso">
                <i class="fas fa-mask"></i> Mentiroso
            </a>
            <a href="ranking-crackrapido.html" class="nav-button crackrapido">
                <i class="fas fa-bolt"></i> Crack Rápido
            </a>
            <a href="quiensabemas.html" class="nav-button quiensabemas">
                <i class="fas fa-play"></i> Jugar QSM
            </a>
        </div>

        <!-- Ranking Principal -->
        <div class="ranking-container quiensabemas">
            <h2 class="ranking-title quiensabemas">
                <i class="fas fa-brain ranking-title-icon"></i>
                TOP 15 Quién Sabe más
            </h2>
             <div class="table-responsive-wrapper">
                <table class="ranking-table">
                    <thead>
                        <tr>
                            <th>Pos</th>
                            <th>Jugador</th>
                            <th>ELO</th>
                            <th>W/L</th>
                            <th class="hide-mobile">Nivel</th>
                        </tr>
                    </thead>
                    <tbody id="ranking-body">
                        <tr>
                            <td colspan="5" class="loading-state">
                                🧠 Buscando a los más inteligentes...
                            </td>
                        </tr>
                    </tbody>
                </table>
             </div>
        </div>

        <!-- Historial de Partidas -->
         <div class="history-container quiensabemas">
            <h2 class="history-title quiensabemas">
                <i class="fas fa-history history-title-icon"></i>
                Historial de Duelos
            </h2>
            <div id="history-list" class="history-list">
                <div class="loading-state">🎯 Revisando los últimos duelos...</div>
            </div>
        </div>

    </main>

    <footer class="site-footer">
        <div class="footer-content">
            <div class="footer-links">
                <a href="index.html"><i class="fas fa-home"></i> Inicio</a>
                <a href="blog.html"><i class="fas fa-blog"></i> Blog</a>
                <a href="contact.html"><i class="fas fa-envelope"></i> Contacto</a>
                <a href="cookies.html"><i class="fas fa-cookie-bite"></i> Cookies</a>
                <a href="privacy.html"><i class="fas fa-lock"></i> Privacidad</a>
                <a href="terminos.html"><i class="fas fa-file-contract"></i> Términos</a>
                <a href="about.html"><i class="fas fa-info-circle"></i> Acerca de</a>
            </div>
            <button class="footer-share-button" onclick="shareSite()"><i class="fas fa-share-alt"></i> Compartir</button>
            <div class="footer-copyright">
                &copy; 2025 Crack Total. Todos los derechos reservados.
            </div>
        </div>
    </footer>

    <!-- Scripts -->
    <script>
    // Sistema de Ranking Quién Sabe más
    async function loadQuienSabeMasRanking() {
        try {
            console.log('🧠 Cargando ranking Quién Sabe más...');
            
            // Esperar a que CrackTotal esté listo
            await new Promise((resolve) => {
                if (window.CrackTotal && window.CrackTotal.initialized) {
                    resolve();
                } else {
                    window.addEventListener('crackTotalReady', resolve);
                    // Fallback timeout
                    setTimeout(resolve, 3000);
                }
            });
            
            // Cargar ranking usando sistema unificado
            const ranking = await window.CrackTotal.getRanking('quiensabemas', 15);
            console.log('✅ Ranking obtenido:', ranking);
            
            const tbody = document.getElementById('ranking-body');
            if (!tbody) return;
            
            if (ranking.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="5" class="no-data">
                            🧠 ¡Sé el primero en jugar Quién Sabe más!
                        </td>
                    </tr>
                `;
                return;
            }
            
            tbody.innerHTML = ranking.map((user, index) => {
                const position = index + 1;
                const winRate = user.winRate || 0;
                const losses = user.played - user.wins;
                const avgScore = user.avgScore || 0;
                
                // ELO simplificado para duelos 1v1
                const baseElo = 1200 + (user.wins * 30) + (winRate * 8) + (avgScore * 5);
                const elo = Math.round(baseElo);
                
                // Nivel simplificado
                let level = 'Novato 🌟';
                if (elo >= 2000 && winRate >= 80) {
                    level = 'Gran Maestro 👑';
                } else if (elo >= 1800 && winRate >= 75) {
                    level = 'Maestro 🏆';
                } else if (elo >= 1600 && winRate >= 65) {
                    level = 'Experto 🎯';
                } else if (elo >= 1400 && winRate >= 55) {
                    level = 'Avanzado 📚';
                } else if (elo >= 1300 && user.played >= 10) {
                    level = 'Intermedio 🧠';
                } else if (user.played >= 5) {
                    level = 'Principiante 🔰';
                }
                
                return `
                    <tr class="ranking-row ${position <= 3 ? 'top-three' : ''}">
                        <td class="position">${position <= 3 ? '🏆' : position}</td>
                        <td class="player-name">${user.displayName}</td>
                        <td class="elo">${elo}</td>
                        <td class="win-loss">${user.wins}W/${losses}L</td>
                        <td class="level hide-mobile">${level}</td>
                    </tr>
                `;
            }).join('');
            
            // Cargar historial usando sistema unificado
            const history = await window.CrackTotal.getHistory('quiensabemas', 20);
            const historyList = document.getElementById('history-list');
            
            if (historyList && history.length > 0) {
                historyList.innerHTML = history.map((match, index) => {
                    // Extraer datos básicos
                    const timestamp = match.timestamp || null;
                    const date = timestamp ? 
                        new Date(timestamp.toDate()).toLocaleDateString('es-ES', {
                            day: '2-digit',
                            month: '2-digit', 
                            year: 'numeric'
                        }) : 'Sin fecha';
                    const time = timestamp ? 
                        new Date(timestamp.toDate()).toLocaleTimeString('es-ES', {
                            hour: '2-digit',
                            minute: '2-digit'
                        }) : '';
                    
                    // Datos del jugador y oponente
                    const playerName = match.players && match.players.length > 0 ? 
                        match.players[0].displayName : 'Jugador';
                    const myScore = match.players && match.players.length > 0 ? 
                        match.players[0].score || 0 : 0;
                    const opponentScore = match.players && match.players.length > 1 ? 
                        match.players[1].score || 0 : 0;
                    const opponentName = match.players && match.players.length > 1 ? 
                        match.players[1].displayName || 'Oponente' : 'Oponente';
                    const result = match.result === 'victory' ? 'victory' : 
                                 match.result === 'draw' ? 'draw' : 'defeat';
                    
                    // Métricas específicas de Quién Sabe más
                    const scoreDifference = myScore - opponentScore;
                    const totalQuestions = match.totalQuestions || 10;
                    const accuracy = totalQuestions > 0 ? Math.round((myScore / totalQuestions) * 100) : 0;
                    const category = match.category || 'General';
                    
                    // Determinar nivel de conocimiento mostrado
                    let performance = 'Estudiante';
                    let performanceClass = 'student';
                    let performanceIcon = '📚';
                    
                    if (myScore >= 9 && result === 'victory') {
                        performance = 'Gran Maestro';
                        performanceClass = 'grandmaster';
                        performanceIcon = '👑';
                    } else if (myScore >= 8 && accuracy >= 80) {
                        performance = 'Experto';
                        performanceClass = 'expert';
                        performanceIcon = '🎯';
                    } else if (myScore >= 7 && accuracy >= 70) {
                        performance = 'Conocedor';
                        performanceClass = 'knowledgeable';
                        performanceIcon = '🧠';
                    } else if (myScore >= 6) {
                        performance = 'Competente';
                        performanceClass = 'competent';
                        performanceIcon = '⚡';
                    } else if (myScore >= 4) {
                        performance = 'Aprendiz';
                        performanceClass = 'apprentice';
                        performanceIcon = '📖';
                    }
                    
                    // Determinar tipo de duelo
                    let matchType = 'Duelo Estándar';
                    let matchClass = 'standard';
                    
                    if (result === 'victory') {
                        if (Math.abs(scoreDifference) >= 5) {
                            matchType = 'Victoria Aplastante';
                            matchClass = 'crushing';
                        } else if (Math.abs(scoreDifference) >= 3) {
                            matchType = 'Victoria Sólida';
                            matchClass = 'solid';
                        } else {
                            matchType = 'Victoria Ajustada';
                            matchClass = 'close';
                        }
                    } else if (result === 'draw') {
                        matchType = 'Empate Épico';
                        matchClass = 'epic-draw';
                    } else {
                        if (Math.abs(scoreDifference) <= 2) {
                            matchType = 'Derrota Heroica';
                            matchClass = 'heroic';
                        } else {
                            matchType = 'Derrota';
                            matchClass = 'defeat';
                        }
                    }
                    
                    // Calcular ELO estimado ganado/perdido
                    const eloChange = result === 'victory' ? 
                        Math.round(20 + (scoreDifference * 3)) : 
                        result === 'draw' ? 0 :
                        Math.round(-20 + (scoreDifference * 3));
                    
                    return `
                        <div class="history-item ${result} ${matchClass}">
                            <div class="match-header">
                                <div class="match-result-info">
                                    <span class="result-icon ${result}">
                                        ${result === 'victory' ? '🏆' : result === 'draw' ? '🤝' : '💪'}
                                    </span>
                                    <div class="player-info">
                                        <span class="player-name">${playerName}</span>
                                        <span class="match-type">${matchType}</span>
                                    </div>
                                </div>
                                <div class="match-date-time">
                                    <span class="date">${date}</span>
                                    <span class="time">${time}</span>
                                </div>
                            </div>
                            
                            <div class="match-stats">
                                <div class="stat-group score-group">
                                    <div class="stat-item primary">
                                        <span class="stat-label">Mi Score</span>
                                        <span class="stat-value score">${myScore}</span>
                                    </div>
                                    <div class="stat-item">
                                        <span class="stat-label">Oponente</span>
                                        <span class="stat-value opponent-score">${opponentScore}</span>
                                    </div>
                                </div>
                                
                                <div class="stat-group performance-group">
                                    <div class="stat-item">
                                        <span class="stat-label">Precisión</span>
                                        <span class="stat-value accuracy ${accuracy >= 80 ? 'excellent' : accuracy >= 60 ? 'good' : 'poor'}">${accuracy}%</span>
                                    </div>
                                    <div class="stat-item">
                                        <span class="stat-label">Diferencia</span>
                                        <span class="stat-value difference ${scoreDifference > 0 ? 'positive' : scoreDifference < 0 ? 'negative' : 'neutral'}">
                                            ${scoreDifference > 0 ? '+' : ''}${scoreDifference}
                                        </span>
                                    </div>
                                    <div class="stat-item">
                                        <span class="stat-label">ELO</span>
                                        <span class="stat-value elo ${eloChange > 0 ? 'positive' : eloChange < 0 ? 'negative' : 'neutral'}">
                                            ${eloChange > 0 ? '+' : ''}${eloChange}
                                        </span>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="match-footer">
                                <div class="performance-badge ${performanceClass}">
                                    <span class="badge-icon">${performanceIcon}</span>
                                    <span class="badge-text">${performance}</span>
                                </div>
                                <div class="match-summary">
                                    <span class="summary-text">
                                        vs ${opponentName} • ${category} • ${totalQuestions} preguntas
                                    </span>
                                </div>
                            </div>
                        </div>
                    `;
                }).join('');
            } else if (historyList) {
                historyList.innerHTML = `
                    <div class="no-data-enhanced">
                        <div class="no-data-icon">🧠</div>
                        <div class="no-data-title">¡Aún no hay duelos!</div>
                        <div class="no-data-text">
                            Jugá tu primer duelo de Quién Sabe más para ver tu historial aquí
                        </div>
                        <a href="quiensabemas.html" class="play-now-btn">
                            <i class="fas fa-brain"></i> Jugar Ahora
                        </a>
                    </div>
                `;
            }
            
        } catch (error) {
            console.error('❌ Error cargando ranking:', error);
            const tbody = document.getElementById('ranking-body');
            if (tbody) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="5" class="error-state">
                            ⚠️ Error al cargar el ranking. Refresca la página.
                        </td>
                    </tr>
                `;
            }
        }
    }
    
    // Función para compartir sitio
    function shareSite() {
        if (navigator.share) {
            navigator.share({
                title: 'Ranking Quién Sabe más - Crack Total',
                text: '¡Mirá el Ranking de Quién Sabe más y comprobá quiénes son los más inteligentes!',
                url: window.location.href
            })
            .catch(err => console.log('Error al compartir:', err));
        } else {
            alert('Tu navegador no soporta la API de Compartir. Copiá el enlace manualmente.');
        }
    }
    
    // Inicializar cuando el DOM esté listo
    document.addEventListener('DOMContentLoaded', loadQuienSabeMasRanking);
    </script>

</body>
</html> 







