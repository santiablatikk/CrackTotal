<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8" />
    <meta name="description" content="PASALA CHE - Ranking global de jugadores. Compite y compara tus puntajes con jugadores de todo el mundo." />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <meta name="theme-color" content="#1e293b">
    <meta name="google-adsense-account" content="ca-pub-9579152019412427">
    <title>Ranking Global - PASALA CHE</title>
    <!-- Preconexiones para mejorar el rendimiento -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <!-- Favicon -->
    <link rel="icon" href="img/favicon.ico" type="image/x-icon">
    <!-- Estilos -->
    <link rel="stylesheet" href="css/styles.css" />
    <link rel="stylesheet" href="css/footer-styles.css" />
    <link rel="stylesheet" href="css/responsive-fixes.css" />
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Fuentes -->
    <link href="https://fonts.googleapis.com/css2?family=Oswald:wght@400;500;600;700&family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <!-- Open Graph tags para compartir en redes sociales -->
    <meta property="og:title" content="Ranking Global - PASALA CHE">
    <meta property="og:description" content="Compara tus puntajes con jugadores de todo el mundo en PASALA CHE.">
    <meta property="og:type" content="website">
    <meta property="og:image" content="img/preview.jpg">
    <!-- Google AdSense -->
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-9579152019412427"
     crossorigin="anonymous"></script>
    
    <style>
      /* Estilos para el ranking */
      .ranking-container {
        width: 100%;
        max-width: 900px;
        margin: 0 auto;
        padding: 20px;
      }
      
      .ranking-header {
        background: rgba(13, 71, 161, 0.6);
        padding: 15px 20px;
        border-radius: 12px 12px 0 0;
        display: flex;
        justify-content: space-between;
        color: white;
        font-weight: 600;
        border: 1px solid rgba(255, 255, 255, 0.1);
        border-bottom: none;
      }
      
      .ranking-header .rank-col {
        width: 10%;
        text-align: center;
      }
      
      .ranking-header .player-col {
        width: 40%;
        text-align: left;
      }
      
      .ranking-header .score-col {
        width: 20%;
        text-align: center;
      }
      
      .ranking-header .date-col {
        width: 30%;
            text-align: center;
      }
      
      .ranking-list {
        border-radius: 0 0 12px 12px;
            overflow: hidden;
        border: 1px solid rgba(255, 255, 255, 0.1);
        border-top: none;
        box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
      }
      
      .ranking-item {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 15px 20px;
        border-bottom: 1px solid rgba(255, 255, 255, 0.05);
        background: rgba(15, 23, 42, 0.7);
        transition: all 0.3s ease;
      }
      
      .ranking-item:last-child {
        border-bottom: none;
      }
      
      .ranking-item:hover {
        background: rgba(30, 41, 59, 0.8);
        transform: translateX(5px);
      }
      
      .ranking-item .rank {
        width: 10%;
        text-align: center;
        font-weight: 700;
        font-size: 1.1rem;
        display: flex;
        align-items: center;
        justify-content: center;
      }
      
      /* Medallas para los tres primeros */
      .rank.rank-1, .rank.rank-2, .rank.rank-3 {
        font-size: 0;
      }
      
      .rank.rank-1:after, .rank.rank-2:after, .rank.rank-3:after {
        font-family: "Font Awesome 6 Free";
        font-weight: 900;
        font-size: 1.5rem;
      }
      
      .rank.rank-1:after {
        content: "\f521"; /* Trophy */
        color: gold;
      }
      
      .rank.rank-2:after {
        content: "\f559"; /* Medal */
        color: silver;
      }
      
      .rank.rank-3:after {
        content: "\f559"; /* Medal */
        color: #cd7f32; /* Bronze */
      }
      
      .ranking-item .player {
        width: 40%;
        display: flex;
        align-items: center;
        gap: 10px;
      }
      
      .player-avatar {
        width: 32px;
        height: 32px;
        border-radius: 50%;
        background: rgba(59, 130, 246, 0.3);
        display: flex;
        align-items: center;
        justify-content: center;
        flex-shrink: 0;
      }
      
      .player-avatar i {
        color: #3b82f6;
        font-size: 0.9rem;
      }
      
      .player-name {
        font-weight: 600;
        overflow: hidden;
        text-overflow: ellipsis;
        white-space: nowrap;
      }
      
      .ranking-item .score {
        width: 20%;
        text-align: center;
        font-weight: 700;
        color: #3b82f6;
      }
      
      .ranking-item .date {
        width: 30%;
        text-align: center;
        font-size: 0.85rem;
        color: rgba(255, 255, 255, 0.7);
      }
      
      .user-highlight {
        background: rgba(59, 130, 246, 0.15) !important;
        border-left: 3px solid #3b82f6;
      }
      
      .loading-state {
        text-align: center;
        padding: 50px 20px;
        color: rgba(255, 255, 255, 0.7);
      }
      
      .loading-spinner {
        display: inline-block;
        width: 40px;
        height: 40px;
        border: 3px solid rgba(255, 255, 255, 0.2);
        border-radius: 50%;
        border-top-color: #3b82f6;
        animation: spin 1s ease-in-out infinite;
        margin-bottom: 15px;
      }
      
      .empty-state {
        text-align: center;
        padding: 50px 20px;
        color: rgba(255, 255, 255, 0.7);
      }
      
      .empty-icon {
        font-size: 2.5rem;
        margin-bottom: 15px;
        color: rgba(255, 255, 255, 0.3);
      }
      
      /* Header */
      .page-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 30px;
      }
      
      .page-title {
        font-size: 2rem;
        font-weight: 700;
        color: white;
        font-family: 'Oswald', sans-serif;
        text-transform: uppercase;
        letter-spacing: 1px;
        margin: 0;
      }
      
      .header-actions {
        display: flex;
        gap: 10px;
      }
      
      .filter-btn, .refresh-btn, .back-btn {
        background: rgba(255, 255, 255, 0.1);
        color: white;
        border: none;
        border-radius: 8px;
        padding: 8px 15px;
        font-size: 0.9rem;
        cursor: pointer;
        transition: all 0.2s ease;
        display: flex;
        align-items: center;
        gap: 8px;
      }
      
      .filter-btn:hover, .refresh-btn:hover, .back-btn:hover {
        background: rgba(255, 255, 255, 0.2);
      }
      
      .filter-dropdown {
            position: relative;
        }
      
      .filter-menu {
        position: absolute;
        top: 100%;
        right: 0;
        background: rgba(15, 23, 42, 0.95);
        border-radius: 8px;
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
        display: none;
        z-index: 100;
        min-width: 180px;
        border: 1px solid rgba(255, 255, 255, 0.1);
        backdrop-filter: blur(8px);
      }
      
      .filter-menu.show {
        display: block;
        animation: fadeInDown 0.2s ease;
      }
      
      .filter-option {
        padding: 10px 15px;
        cursor: pointer;
        transition: all 0.2s;
        display: flex;
        align-items: center;
        gap: 10px;
      }
      
      .filter-option:hover {
        background: rgba(255, 255, 255, 0.1);
      }
      
      .filter-option.selected {
        color: #3b82f6;
        font-weight: 600;
      }
      
      .filter-option i {
        opacity: 0;
        transition: all 0.2s;
      }
      
      .filter-option.selected i {
        opacity: 1;
      }
      
      @keyframes fadeInDown {
        from {
          opacity: 0;
          transform: translateY(-10px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }
      
      /* Responsive */
      @media (max-width: 768px) {
        .ranking-header .date-col,
        .ranking-item .date {
          display: none;
        }
        
        .ranking-header .rank-col,
        .ranking-item .rank {
          width: 15%;
        }
        
        .ranking-header .player-col,
        .ranking-item .player {
          width: 55%;
        }
        
        .ranking-header .score-col,
        .ranking-item .score {
          width: 30%;
        }
      }
      
      @media (max-width: 480px) {
        .page-header {
          flex-direction: column;
          align-items: flex-start;
          gap: 15px;
        }
        
        .header-actions {
          width: 100%;
          justify-content: space-between;
        }
        
        .page-title {
          font-size: 1.5rem;
        }
        
        .filter-btn, .refresh-btn, .back-btn {
          font-size: 0.8rem;
          padding: 6px 10px;
        }
        
        .player-avatar {
          width: 28px;
          height: 28px;
        }
      }
      
      /* Add styles for the clickable header */
      .header-link {
        display: flex;
        flex-direction: column;
        align-items: center;
        text-decoration: none;
        color: inherit;
        transition: transform 0.3s ease;
      }
      
      .header-link:hover {
        transform: scale(1.02);
      }
      
      .header-link:hover .title-text {
        text-shadow: 0 0 15px rgba(255, 255, 255, 0.5);
      }
      
      .header-link:hover .ball-icon {
        animation: bounce 0.8s ease infinite;
      }
    </style>
</head>
<body>
    <!-- Partículas de fondo -->
    <div id="particles-js"></div>
    
    <div class="app-container">
      <!-- Header con título principal -->
        <header class="app-header">
        <a href="pasalache.html" class="header-link">
            <div class="logo-animation">
                <i class="fas fa-futbol ball-icon bounce"></i>
            </div>
                <h1 class="title-text">PASALA CHE</h1>
          <p class="subtitle">Ranking Global de Jugadores</p>
            </a>
        <a href="pasalache.html" class="return-portal-link"><i class="fas fa-arrow-left"></i> Volver al Juego</a>
        </header>
        
        <div class="ranking-container">
        <!-- Header con título y acciones -->
        <div class="page-header">
          <h2 class="page-title"><i class="fas fa-trophy"></i> Mejores Jugadores</h2>
          
          <div class="header-actions">
            <button id="back-btn" class="back-btn" onclick="window.location.href='pasalache.html'">
              <i class="fas fa-arrow-left"></i> <span>Volver</span>
            </button>
            
            <div class="filter-dropdown">
              <button id="filter-btn" class="filter-btn">
                <i class="fas fa-filter"></i> <span>Filtrar</span>
              </button>
              
              <div id="filter-menu" class="filter-menu">
                <div class="filter-option selected" data-filter="all">
                  <i class="fas fa-check"></i> Todos los tiempos
                </div>
                <div class="filter-option" data-filter="week">
                  <i class="fas fa-check"></i> Esta semana
                </div>
                <div class="filter-option" data-filter="month">
                  <i class="fas fa-check"></i> Este mes
                </div>
                <div class="filter-option" data-filter="day">
                  <i class="fas fa-check"></i> Hoy
                </div>
              </div>
            </div>
            
            <button id="refresh-btn" class="refresh-btn">
              <i class="fas fa-sync-alt"></i> <span>Actualizar</span>
            </button>
          </div>
            </div>

        <!-- Ranking table header -->
        <div class="ranking-header">
          <div class="rank-col">Pos</div>
          <div class="player-col">Jugador</div>
          <div class="score-col">Puntos</div>
          <div class="date-col">Fecha</div>
            </div>
            
        <!-- Ranking list -->
        <div class="ranking-list" id="ranking-list">
          <!-- Estado de carga -->
          <div class="loading-state" id="loading-state">
            <div class="loading-spinner"></div>
                <p>Cargando ranking...</p>
            </div>
            
          <!-- Estado vacío (se muestra si no hay datos) -->
          <div class="empty-state" id="empty-state" style="display:none">
            <div class="empty-icon">
              <i class="fas fa-trophy"></i>
            </div>
            <h3>Aún no hay puntuaciones</h3>
            <p>¡Sé el primero en jugar y aparecer en el ranking!</p>
            </div>
            
          <!-- Las entradas del ranking se cargarán dinámicamente aquí -->
        </div>
    </div>
    
    <!-- Footer -->
    <footer class="site-footer">
        <div class="footer-content">
            <div class="footer-links">
                <a href="index.html"><i class="fas fa-home"></i> Inicio</a>
                <a href="blog.html"><i class="fas fa-blog"></i> Blog</a>
                <a href="contact.html"><i class="fas fa-envelope"></i> Contacto</a>
                <a href="cookies.html"><i class="fas fa-cookie-bite"></i> Cookies</a>
                <a href="privacy.html"><i class="fas fa-lock"></i> Privacidad</a>
                <a href="terms.html"><i class="fas fa-file-contract"></i> Terminos</a>
            </div>
            <div class="footer-actions">
                <button id="footer-share-button" class="share-button"><i class="fas fa-share-alt"></i> Compartir</button>
                <div class="social-icons">
                    <a href="https://www.facebook.com/pasalachee" target="_blank" aria-label="Facebook" class="social-icon"><i class="fab fa-facebook-f"></i></a>
                    <a href="https://twitter.com/pasalachee" target="_blank" aria-label="Twitter" class="social-icon"><i class="fab fa-twitter"></i></a>
                    <a href="https://www.instagram.com/pasalachee" target="_blank" aria-label="Instagram" class="social-icon"><i class="fab fa-instagram"></i></a>
                    <a href="https://www.youtube.com/c/pasalachee" target="_blank" aria-label="YouTube" class="social-icon"><i class="fab fa-youtube"></i></a>
                </div>
            </div>
        </div>
        <div class="footer-copyright">
            &copy; 2025 PASALA CHE - El Juego del Rosco Futbolero. Todos los derechos reservados.
        </div>
    </footer>
    </div>

    <!-- Toast para notificaciones -->
    <div id="notification" class="toast" style="display: none;"></div>
    
    <!-- Cookie Consent Banner -->
    <div id="cookieConsent" class="cookie-consent" style="display: none;">
      <p>Utilizamos cookies para mejorar tu experiencia en nuestra web. Al continuar navegando, aceptas nuestra <a href="cookies.html">política de cookies</a>.</p>
      <div class="cookie-consent-buttons">
        <button class="cookie-btn cookie-accept">Aceptar</button>
        <button class="cookie-btn cookie-decline">Rechazar</button>
      </div>
    </div>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/particles.js/2.0.0/particles.min.js"></script>
    <script src="js/particles-config.js"></script>
    <script src="js/utils.js"></script>
    
    <!-- Firebase Scripts -->
    <script type="module">
      // Import the functions you need from the SDKs
      import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
      import { getFirestore, collection, query, orderBy, limit, getDocs, where, Timestamp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js";
      
      // Firebase configuration
      const firebaseConfig = {
        apiKey: "AIzaSyA_3zDONffadhCSFgyZziachdherN19vYr4",
        authDomain: "cracktotal-cd2e7.firebaseapp.com",
        projectId: "cracktotal-cd2e7",
        storageBucket: "cracktotal-cd2e7.firebasestorage.app",
        messagingSenderId: "121839145458",
        appId: "1:121839145458:web:ec36c626aca23e80562fdf",
        measurementId: "G-5XP3T1RTH7"
      };
      
      // Initialize Firebase
      const app = initializeApp(firebaseConfig);
      const db = getFirestore(app);
      
      // DOM elements
      const rankingList = document.getElementById('ranking-list');
      const loadingState = document.getElementById('loading-state');
      const emptyState = document.getElementById('empty-state');
      const filterBtn = document.getElementById('filter-btn');
      const filterMenu = document.getElementById('filter-menu');
      const filterOptions = document.querySelectorAll('.filter-option');
      const refreshBtn = document.getElementById('refresh-btn');
      
      // Current filter
      let currentFilter = 'all';
      
      // Toggle filter menu
      filterBtn.addEventListener('click', () => {
        filterMenu.classList.toggle('show');
      });
      
      // Close filter menu when clicking outside
      document.addEventListener('click', (e) => {
        if (!filterBtn.contains(e.target) && !filterMenu.contains(e.target)) {
          filterMenu.classList.remove('show');
        }
      });
      
      // Handle filter selection
      filterOptions.forEach(option => {
        option.addEventListener('click', () => {
          const filter = option.getAttribute('data-filter');
          
          // Update selected option
          filterOptions.forEach(opt => opt.classList.remove('selected'));
          option.classList.add('selected');
          
          // Update current filter and refresh data
          currentFilter = filter;
          fetchRankingData();
          
          // Close menu
          filterMenu.classList.remove('show');
        });
      });
      
      // Refresh button handler
      refreshBtn.addEventListener('click', fetchRankingData);
      
      // Format date function
      function formatDate(timestamp) {
        if (!timestamp) return 'Desconocido';
        
        const date = timestamp.toDate ? timestamp.toDate() : new Date(timestamp);
        const now = new Date();
        const diffMs = now - date;
        const diffDays = Math.floor(diffMs / (1000 * 60 * 60 * 24));
        
        if (diffDays === 0) {
          return 'Hoy, ' + date.toLocaleTimeString('es-ES', { hour: '2-digit', minute: '2-digit' });
        } else if (diffDays === 1) {
          return 'Ayer, ' + date.toLocaleTimeString('es-ES', { hour: '2-digit', minute: '2-digit' });
        } else if (diffDays < 7) {
          return `Hace ${diffDays} días`;
        } else {
          return date.toLocaleDateString('es-ES', { day: '2-digit', month: '2-digit', year: 'numeric' });
        }
      }
      
      // Fetch ranking data from Firebase
      async function fetchRankingData() {
        try {
          // Show loading state
          loadingState.style.display = 'block';
          emptyState.style.display = 'none';
          
          // Clear current list
          const existingItems = document.querySelectorAll('.ranking-item');
          existingItems.forEach(item => item.remove());
          
          // Create query based on current filter
          let q;
          const gamesRef = collection(db, 'games');
          
          if (currentFilter === 'all') {
            q = query(gamesRef, orderBy('score', 'desc'), limit(30));
          } else {
            let startDate;
            const now = new Date();
            
            if (currentFilter === 'day') {
              // Today
              startDate = new Date(now.setHours(0, 0, 0, 0));
            } else if (currentFilter === 'week') {
              // Start of week (Monday)
              const day = now.getDay();
              const diff = now.getDate() - day + (day === 0 ? -6 : 1);
              startDate = new Date(now.setDate(diff));
              startDate.setHours(0, 0, 0, 0);
            } else if (currentFilter === 'month') {
              // Start of month
              startDate = new Date(now.getFullYear(), now.getMonth(), 1);
            }
            
            q = query(
              gamesRef,
              where('timestamp', '>=', Timestamp.fromDate(startDate)),
              orderBy('timestamp', 'desc'),
              orderBy('score', 'desc'),
              limit(30)
            );
          }
          
          // Execute query
          const querySnapshot = await getDocs(q);
          
          // Check if we have results
          if (querySnapshot.empty) {
            loadingState.style.display = 'none';
            emptyState.style.display = 'block';
            return;
          }
          
          // Get current player name from localStorage
          const currentPlayerName = localStorage.getItem('playerName') || localStorage.getItem('userName');
          
          // Process results
          querySnapshot.docs.forEach((doc, index) => {
            const data = doc.data();
            
            // Create ranking item
            const rankingItem = document.createElement('div');
            rankingItem.className = 'ranking-item';
            
            // Highlight current user
            if (currentPlayerName && data.playerName === currentPlayerName) {
              rankingItem.classList.add('user-highlight');
            }
            
            // Create HTML structure
            rankingItem.innerHTML = `
              <div class="rank rank-${index + 1}">${index + 1}</div>
              <div class="player">
                <div class="player-avatar">
                  <i class="fas fa-user"></i>
                </div>
                <div class="player-name">${data.playerName || 'Jugador Anónimo'}</div>
              </div>
              <div class="score">${data.score}</div>
              <div class="date">${formatDate(data.timestamp)}</div>
            `;
            
            // Add to the list
            rankingList.appendChild(rankingItem);
          });
          
          // Hide loading state
          loadingState.style.display = 'none';
        } catch (error) {
          console.error('Error fetching ranking data: ', error);
          
          // Show error state
          loadingState.style.display = 'none';
          emptyState.style.display = 'block';
          emptyState.innerHTML = `
            <div class="empty-icon">
              <i class="fas fa-exclamation-circle"></i>
            </div>
            <h3>Error al cargar el ranking</h3>
            <p>Intenta actualizar la página o vuelve más tarde.</p>
          `;
        }
      }
      
      // Setup page on load
      document.addEventListener('DOMContentLoaded', () => {
        // Configure particles.js
        if (typeof particlesJS !== 'undefined' && document.getElementById('particles-js')) {
          if (typeof particlesConfig !== 'undefined') {
            particlesJS('particles-js', particlesConfig);
          }
        }
        
        // Fetch initial data
        fetchRankingData();
        
        // Verificar consentimiento de cookies
        if (!localStorage.getItem('cookieConsent')) {
          const cookieConsent = document.getElementById('cookieConsent');
          if (cookieConsent) {
            cookieConsent.style.display = 'flex';
            
            const acceptBtn = cookieConsent.querySelector('.cookie-accept');
            const declineBtn = cookieConsent.querySelector('.cookie-decline');
            
            acceptBtn?.addEventListener('click', function() {
              localStorage.setItem('cookieConsent', 'accepted');
              cookieConsent.style.display = 'none';
            });
            
            declineBtn?.addEventListener('click', function() {
              localStorage.setItem('cookieConsent', 'declined');
              cookieConsent.style.display = 'none';
            });
          }
        }
        
        // Share button functionality
        const shareButton = document.getElementById('footer-share-button');
        if (shareButton && navigator.share) {
            shareButton.addEventListener('click', async () => {
                try {
                    await navigator.share({
                        title: document.title,
                text: '¡Mira el ranking global de PASALA CHE!',
                        url: window.location.href
                    });
                    console.log('Contenido compartido con éxito');
                } catch (err) {
                    console.error('Error al compartir:', err);
                }
            });
        } else if (shareButton) {
            shareButton.style.display = 'none';
        }
      });
    </script>
    <!-- Scripts necesarios -->
    <script src="js/ranking.js"></script>
    <script src="js/responsive.js"></script>
</body>
</html> 

