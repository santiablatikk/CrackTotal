<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mi Dashboard - CRACK TOTAL</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="css/user/dashboard-modern.css">
    <link rel="stylesheet" href="css/user/game-notifications.css">
    <link rel="icon" href="favicon.ico" type="image/x-icon">
    <meta name="theme-color" content="#e11d48">
</head>
<body>
    <div class="user-page-container">
        <!-- Cabecera -->
        <header class="user-page-header">
            <a href="index.html" class="back-button">
                <i class="fas fa-arrow-left"></i>
            </a>
            <div class="app-header">
                <div class="logo-animation">
                    <i class="fas fa-futbol ball-icon bounce"></i>
                </div>
                <a href="#" class="title-link">
                    <h1 class="title-text">CRACK TOTAL</h1>
                </a>
                <p class="subtitle">El juego del fútbol argentino</p>
            </div>
            <div class="user-profile-info">
                <div class="profile-username-wrapper">
                    <span class="profile-username" id="profile-username">Cargando...</span>
                    <div class="level-container">
                        <span class="level-badge" id="level-badge">-</span>
                        <span class="profile-level-text" id="profile-level-text">Nivel -</span>
                    </div>
                </div>
            </div>
        </header>

        <!-- Selector de juego -->
        <div class="game-selector">
            <div class="game-options">
                <div class="game-option active" data-game="pasala-che">
                    <div class="game-icon">
                        <i class="fas fa-circle-notch"></i>
                    </div>
                    <span class="game-name">PASALA CHE</span>
                </div>
                <div class="game-option" data-game="quien-sabe-theme">
                    <div class="game-icon">
                        <i class="fas fa-futbol"></i>
                    </div>
                    <span class="game-name">¿QUIÉN SABE MÁS?</span>
                </div>
            </div>
        </div>

        <!-- Pestañas de Navegación -->
        <div class="tabs-container">
            <div class="tabs-header">
                <div class="tab active" data-tab="profile">
                    <i class="fas fa-user"></i>
                    <span>Mi Perfil</span>
                </div>
                <div class="tab" data-tab="stats">
                    <i class="fas fa-chart-line"></i>
                    <span>Estadísticas</span>
                </div>
                <div class="tab" data-tab="ranking">
                    <i class="fas fa-trophy"></i>
                    <span>Ranking</span>
                </div>
                <div class="tab" data-tab="achievements">
                    <i class="fas fa-medal"></i>
                    <span>Logros</span>
                </div>
            </div>

            <!-- Contenido Principal (Pestañas) -->
            <main class="tabs-content">
                <!-- Pestaña: Mi Perfil -->
                <div class="tab-content active" id="profile-content">
                    <div class="loading-content" id="profile-loading">
                        <div class="loading-spinner"></div>
                        <p>Cargando datos del perfil...</p>
                    </div>
                    <div class="profile-content">
                        <!-- Sección de Nivel y Rango -->
                        <section class="level-rank-section">
                            <h2 class="section-title visually-hidden">Nivel y Rango</h2>
                            <div class="level-rank-grid">
                                <div class="level-progress-container">
                                    <div class="level-info">
                                        <span class="current-level" id="profile-level-display">Nivel 1</span>
                                        <span class="xp-progress" id="xp-progress-text">0 / 100 XP</span>
                                    </div>
                                    <div class="level-progress-bar">
                                        <div class="level-progress-fill" id="level-progress-fill" style="width: 0%;"></div>
                                    </div>
                                </div>
                                <div class="rank-best-score">
                                    <div class="rank-info">
                                        <i class="fas fa-trophy rank-icon"></i>
                                        <span class="rank-label">Ranking Actual</span>
                                        <span class="rank-value" id="current-rank-profile">-</span>
                                    </div>
                                    <div class="best-score-info">
                                        <i class="fas fa-star score-icon"></i>
                                        <span class="score-label">Mejor Puntaje</span>
                                        <span class="score-value" id="best-score-profile">-</span>
                                    </div>
                                </div>
                            </div>
                        </section>

                        <div class="section-divider"></div>

                        <!-- Estadísticas Resumidas -->
                        <section class="profile-stats-section">
                            <h2 class="section-title">Mis Estadísticas Clave</h2>
                            <div class="stats-grid">
                                <div class="stat-item" data-stat="games-played">
                                    <div class="stat-icon"><i class="fas fa-gamepad"></i></div>
                                    <div class="stat-details">
                                        <span class="stat-label">Partidas Jugadas</span>
                                        <span class="stat-number" id="stat-games">-</span>
                                    </div>
                                </div>
                                <div class="stat-item" data-stat="win-rate">
                                    <div class="stat-icon"><i class="fas fa-trophy"></i></div>
                                    <div class="stat-details">
                                        <span class="stat-label">Tasa de Victoria</span>
                                        <span class="stat-number" id="stat-winrate">-</span>
                                    </div>
                                </div>
                                <div class="stat-item" data-stat="accuracy">
                                    <div class="stat-icon"><i class="fas fa-bullseye"></i></div>
                                    <div class="stat-details">
                                        <span class="stat-label">Precisión Media</span>
                                        <span class="stat-number" id="stat-accuracy">-</span>
                                    </div>
                                </div>
                                <div class="stat-item" data-stat="avg-time">
                                    <div class="stat-icon"><i class="fas fa-stopwatch"></i></div>
                                    <div class="stat-details">
                                        <span class="stat-label">Tiempo Promedio</span>
                                        <span class="stat-number" id="stat-avgtime">-</span>
                                    </div>
                                </div>
                            </div>
                        </section>

                        <div class="section-divider"></div>

                        <!-- Actividad Reciente (Placeholder) -->
                        <section class="recent-activity-section">
                            <h2 class="section-title">Actividad Reciente</h2>
                            <div class="activity-feed">
                                <div class="placeholder-message">
                                    <i class="fas fa-history"></i>
                                    <p>Tu actividad reciente aparecerá aquí.</p>
                                </div>
                            </div>
                        </section>
                    </div>
                </div>

                <!-- Pestaña: Estadísticas -->
                <div class="tab-content" id="stats-content">
                    <div class="loading-content" id="stats-loading">
                        <div class="loading-spinner"></div>
                        <p>Cargando estadísticas...</p>
                    </div>
                    <div class="stats-content">
                        <!-- Gráficos y Estadísticas Detalladas -->
                        <section class="detailed-stats-section">
                            <h2 class="section-title">Estadísticas Detalladas</h2>
                            <div class="placeholder-message">
                                <i class="fas fa-chart-line"></i>
                                <p>Próximamente estadísticas detalladas</p>
                            </div>
                        </section>
                    </div>
                </div>

                <!-- Pestaña: Ranking -->
                <div class="tab-content" id="ranking-content">
                    <div class="loading-content" id="ranking-loading">
                        <div class="loading-spinner"></div>
                        <p>Cargando ranking global...</p>
                    </div>
                    <div class="ranking-content">                        
                        <!-- Filtros de ranking -->
                        <section class="ranking-filters">
                            <div class="filter-options">
                                <span class="filter-label">Ver ranking:</span>
                                <button class="filter-btn active" data-filter="global">Global</button>
                                <button class="filter-btn" data-filter="monthly">Mensual</button>
                                <button class="filter-btn" data-filter="weekly">Semanal</button>
                                <div class="filter-search">
                                    <input type="text" id="ranking-search" placeholder="Buscar jugador...">
                                    <button id="ranking-search-btn"><i class="fas fa-search"></i></button>
                                </div>
                            </div>
                        </section>
                        
                        <!-- Estadísticas globales -->
                        <section class="global-ranking-stats">
                            <div class="stats-grid">
                                <div class="stat-item" data-stat="total-players">
                                    <div class="stat-icon"><i class="fas fa-users"></i></div>
                                    <div class="stat-details">
                                        <span class="stat-label">Jugadores Totales</span>
                                        <span class="stat-number">-</span>
                                    </div>
                                </div>
                                <div class="stat-item" data-stat="total-games">
                                    <div class="stat-icon"><i class="fas fa-gamepad"></i></div>
                                    <div class="stat-details">
                                        <span class="stat-label">Partidas Jugadas</span>
                                        <span class="stat-number">-</span>
                                    </div>
                                </div>
                                <div class="stat-item" data-stat="avg-score">
                                    <div class="stat-icon"><i class="fas fa-chart-line"></i></div>
                                    <div class="stat-details">
                                        <span class="stat-label">Puntuación Media</span>
                                        <span class="stat-number">-</span>
                                    </div>
                                </div>
                                <div class="stat-item" data-stat="max-score">
                                    <div class="stat-icon"><i class="fas fa-trophy"></i></div>
                                    <div class="stat-details">
                                        <span class="stat-label">Puntuación Máxima</span>
                                        <span class="stat-number">-</span>
                                    </div>
                                </div>
                            </div>
                        </section>
                        
                        <!-- Top 3 jugadores -->
                        <section class="top-players-section">
                            <h2 class="section-title">Top Jugadores</h2>
                            <div class="top-players-grid">
                                <div class="top-player-card rank-2">
                                    <div class="player-rank-badge">#2</div>
                                    <div class="player-avatar">D</div>
                                    <div class="player-name" id="top-player-2-name">-</div>
                                    <div class="player-score" id="top-player-2-score">-</div>
                                </div>
                                
                                <div class="top-player-card rank-1">
                                    <div class="player-rank-badge">#1</div>
                                    <div class="player-avatar">M</div>
                                    <div class="player-name" id="top-player-1-name">-</div>
                                    <div class="player-score" id="top-player-1-score">-</div>
                                </div>
                                
                                <div class="top-player-card rank-3">
                                    <div class="player-rank-badge">#3</div>
                                    <div class="player-avatar">J</div>
                                    <div class="player-name" id="top-player-3-name">-</div>
                                    <div class="player-score" id="top-player-3-score">-</div>
                                </div>
                            </div>
                        </section>
                        
                        <!-- Tabla de ranking -->
                        <section class="ranking-table-section">
                            <h2 class="section-title">Clasificación Global</h2>
                            <div class="ranking-table-container">
                                <table class="improved-ranking-table">
                                    <thead>
                                        <tr>
                                            <th width="15%">Posición</th>
                                            <th width="40%">Jugador</th>
                                            <th width="15%" class="score-col">Puntos</th>
                                            <th width="15%" class="games-col">Partidas</th>
                                            <th width="15%" class="last-played-col">Última Partida</th>
                                        </tr>
                                    </thead>
                                    <tbody id="ranking-table-body">
                                        <tr class="loading-row">
                                            <td colspan="5">
                                                <div class="loading-spinner"></div> Cargando ranking...
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                                
                                <!-- Paginación -->
                                <div class="pagination-container">
                                    <button class="pagination-btn" id="prev-page-btn" disabled><i class="fas fa-chevron-left"></i> Anterior</button>
                                    <span id="pagination-info">Página 1 de 1</span>
                                    <button class="pagination-btn" id="next-page-btn" disabled>Siguiente <i class="fas fa-chevron-right"></i></button>
                                </div>
                            </div>
                        </section>
                    </div>
                </div>

                <!-- Pestaña: Logros -->
                <div class="tab-content" id="achievements-content">
                    <div class="loading-content" id="achievements-loading">
                        <div class="loading-spinner"></div>
                        <p>Cargando logros...</p>
                    </div>
                    <div class="achievements-content">
                        <div class="placeholder-message">
                            <i class="fas fa-medal"></i>
                            <p>Próximamente logros y trofeos</p>
                        </div>
                    </div>
                </div>
            </main>
        </div>
    </div>

    <!-- Footer -->
    <footer class="policy-footer">
        <div class="footer-links-mini">
            <a href="index.html"><i class="fas fa-home"></i> Inicio</a>
            <a href="game.html"><i class="fas fa-gamepad"></i> Jugar</a>
            <a href="user-dashboard.html"><i class="fas fa-user"></i> Mi Dashboard</a>
            <a href="logros.html"><i class="fas fa-medal"></i> Logros</a>
            <a href="terms.html"><i class="fas fa-file-contract"></i> Términos</a>
            <a href="privacy.html"><i class="fas fa-lock"></i> Privacidad</a>
            <a href="blog.html"><i class="fas fa-blog"></i> Blog</a>
            <a href="cookies.html"><i class="fas fa-cookie-bite"></i> Cookies</a>
            <a href="contact.html"><i class="fas fa-envelope"></i> Contacto</a>
            <a href="about.html"><i class="fas fa-info-circle"></i> Acerca de</a>
        </div>
        <div class="copyright-text">&copy; 2025 CRACK TOTAL - Todos los derechos reservados.</div>
        <div class="footer-social-icons">
            <a href="#" class="social-icon"><i class="fab fa-facebook-f"></i></a>
            <a href="#" class="social-icon"><i class="fab fa-twitter"></i></a>
            <a href="#" class="social-icon"><i class="fab fa-instagram"></i></a>
            <a href="#" class="social-icon"><i class="fab fa-youtube"></i></a>
        </div>
    </footer>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="js/user-dashboard.js"></script>
    <script src="js/game-completion.js"></script>
    <script>
        // Función para manejar logros similar a logros.html
        document.addEventListener('DOMContentLoaded', function() {
            // Array con todos los logros posibles
            const achievements = [
                {
                    id: 'first_game',
                    icon: 'fas fa-gamepad',
                    title: 'Primer Juego',
                    description: 'Completa tu primer juego de PASALA CHÉ.',
                    category: 'beginner',
                    maxCount: 1,
                    unlocked: false,
                    count: 0,
                    date: null
                },
                {
                    id: 'perfect_game',
                    icon: 'fas fa-star',
                    title: 'Juego Perfecto',
                    description: 'Completa un juego respondiendo correctamente todas las preguntas.',
                    category: 'expert',
                    maxCount: 10,
                    unlocked: false,
                    count: 0,
                    date: null
                },
                {
                    id: 'streak_5',
                    icon: 'fas fa-fire',
                    title: 'Racha Caliente',
                    description: 'Responde correctamente 5 preguntas seguidas.',
                    category: 'beginner',
                    maxCount: 20,
                    unlocked: false,
                    count: 0,
                    date: null
                },
                {
                    id: 'streak_10',
                    icon: 'fas fa-fire-alt',
                    title: 'Racha Imparable',
                    description: 'Responde correctamente 10 preguntas seguidas.',
                    category: 'intermediate',
                    maxCount: 10,
                    unlocked: false,
                    count: 0,
                    date: null
                },
                {
                    id: 'night_owl',
                    icon: 'fas fa-moon',
                    title: 'Búho Nocturno',
                    description: 'Juega durante la noche (entre las 11pm y 5am).',
                    category: 'special',
                    maxCount: 1,
                    unlocked: false,
                    count: 0,
                    date: null
                },
                {
                    id: 'early_bird',
                    icon: 'fas fa-sun',
                    title: 'Madrugador',
                    description: 'Juega temprano en la mañana (entre las 5am y 8am).',
                    category: 'special',
                    maxCount: 1,
                    unlocked: false,
                    count: 0,
                    date: null
                },
                {
                    id: 'completion_master',
                    icon: 'fas fa-award',
                    title: 'Maestro Completista',
                    description: 'Completa un juego respondiendo a más de 20 preguntas.',
                    category: 'intermediate',
                    maxCount: 5,
                    unlocked: false,
                    count: 0,
                    date: null
                }
            ];
            
            // Variable para almacenar el IP del usuario
            let userIP = '';
            
            // Función para obtener el IP del usuario usando una API pública
            async function getUserIP() {
                try {
                    const response = await fetch('https://api.ipify.org?format=json');
                    const data = await response.json();
                    userIP = data.ip;
                    console.log('IP del usuario detectada:', userIP);
                    
                    // Una vez que tenemos el IP, cargar los logros
                    loadUserAchievements();
                } catch (error) {
                    console.error('Error al obtener IP:', error);
                    // Si falla, usar un valor por defecto para no bloquear la funcionalidad
                    userIP = 'unknown-ip';
                    loadUserAchievements();
                }
            }
            
            // Función para formatear la fecha en formato DD/MM/YYYY
            function formatDate(date) {
                if (!date) return 'Pendiente';
                
                const d = new Date(date);
                const day = String(d.getDate()).padStart(2, '0');
                const month = String(d.getMonth() + 1).padStart(2, '0');
                const year = d.getFullYear();
                
                return `${day}/${month}/${year}`;
            }
            
            // Función para cargar los logros en la interfaz
            function loadAchievements(category = 'all') {
                const container = document.querySelector('.achievements-grid');
                if (!container) return;
                
                container.innerHTML = '';
                
                const filteredAchievements = category === 'all' 
                    ? achievements 
                    : achievements.filter(a => a.category === category);
                    
                filteredAchievements.forEach(achievement => {
                    const card = document.createElement('div');
                    card.className = `achievement-card ${achievement.unlocked ? '' : 'locked'}`;
                    card.setAttribute('data-category', achievement.category);
                    
                    // Calcular el progreso
                    const progress = achievement.maxCount > 1 
                        ? Math.min(100, (achievement.count / achievement.maxCount) * 100) 
                        : (achievement.unlocked ? 100 : 0);
                    
                    // Formatear la fecha
                    const achievementDate = formatDate(achievement.date);
                    
                    card.innerHTML = `
                        <div class="achievement-icon">
                            <i class="${achievement.icon}"></i>
                        </div>
                        <div class="achievement-details">
                            <div class="achievement-title">${achievement.title}</div>
                            <div class="achievement-description">${achievement.description}</div>
                            <div class="achievement-progress">
                                <div class="achievement-progress-bar" style="width: ${progress}%"></div>
                            </div>
                            <div class="achievement-count">
                                ${achievement.maxCount > 1 ? `${achievement.count}/${achievement.maxCount}` : (achievement.unlocked ? 'Completado' : 'Bloqueado')}
                            </div>
                            <div class="achievement-date">${achievement.unlocked ? achievementDate : ''}</div>
                        </div>
                    `;
                    
                    container.appendChild(card);
                });
                
                // Si no hay logros, mostrar un mensaje
                if (filteredAchievements.length === 0) {
                    const emptyState = document.createElement('div');
                    emptyState.className = 'no-achievements';
                    emptyState.innerHTML = `
                        <i class="fas fa-trophy"></i>
                        <p>No hay logros disponibles en esta categoría.</p>
                    `;
                    container.appendChild(emptyState);
                }
            }
            
            // Generar un ID único basado en el IP para guardar y recuperar logros
            function getAchievementsStorageKey() {
                return `userAchievements_${userIP}`;
            }
            
            // Cargar logros del usuario desde localStorage basado en su IP
            function loadUserAchievements() {
                const container = document.querySelector('.achievements-grid');
                if (!container) return;
                
                // Mostrar estado de carga
                container.innerHTML = `
                    <div class="loading-achievements">
                        <i class="fas fa-circle-notch fa-spin"></i>
                        <p>Cargando tus logros...</p>
                    </div>
                `;
                
                // Simular tiempo de carga
                setTimeout(() => {
                    const storageKey = getAchievementsStorageKey();
                    const savedAchievements = localStorage.getItem(storageKey);
                    
                    if (savedAchievements) {
                        try {
                            const parsedAchievements = JSON.parse(savedAchievements);
                            
                            // Actualizar los logros con los datos guardados
                            parsedAchievements.forEach(saved => {
                                const achievement = achievements.find(a => a.id === saved.id);
                                if (achievement) {
                                    achievement.unlocked = saved.unlocked || false;
                                    achievement.count = saved.count || 0;
                                    achievement.date = saved.date || null;
                                }
                            });
                            
                            console.log(`Logros cargados para IP: ${userIP}`);
                        } catch (error) {
                            console.error('Error al cargar logros:', error);
                        }
                    } else {
                        console.log(`No hay logros guardados para IP: ${userIP}`);
                    }
                    
                    // Cargar logros en la interfaz
                    const activeFilter = document.querySelector('.achievement-filter.active');
                    const category = activeFilter ? activeFilter.getAttribute('data-category') : 'all';
                    loadAchievements(category);
                }, 1200);
            }
            
            // Función para mostrar una notificación de logro desbloqueado
            function showAchievementNotification(title, message) {
                const notification = document.createElement('div');
                notification.className = 'achievement-notification';
                notification.innerHTML = `
                    <div class="notification-icon">
                        <i class="fas fa-trophy"></i>
                    </div>
                    <div class="notification-content">
                        <h3>${title}</h3>
                        <p>${message}</p>
                    </div>
                    <button class="notification-close">
                        <i class="fas fa-times"></i>
                    </button>
                `;
                
                document.body.appendChild(notification);
                
                // Mostrar con animación
                setTimeout(() => {
                    notification.classList.add('show');
                }, 100);
                
                // Cerrar automáticamente después de 5 segundos
                setTimeout(() => {
                    notification.classList.remove('show');
                    setTimeout(() => {
                        notification.remove();
                    }, 300);
                }, 5000);
                
                // Cerrar manualmente
                notification.querySelector('.notification-close').addEventListener('click', function() {
                    notification.classList.remove('show');
                    setTimeout(() => {
                        notification.remove();
                    }, 300);
                });
            }
            
            // Función para desbloquear un logro
            window.unlockAchievement = function(achievementId, silent = false) {
                if (!userIP) {
                    console.error('No se puede desbloquear el logro sin IP del usuario');
                    return false;
                }
                
                const achievement = achievements.find(a => a.id === achievementId);
                if (achievement) {
                    const wasAlreadyUnlocked = achievement.unlocked && achievement.count >= achievement.maxCount;
                    
                    // Si ya está completamente desbloqueado y no es acumulable, no hacer nada
                    if (wasAlreadyUnlocked && achievement.maxCount === 1) {
                        return false;
                    }
                    
                    // Actualizar estado del logro
                    achievement.unlocked = true;
                    achievement.count = achievement.count + 1 > achievement.maxCount 
                        ? achievement.maxCount 
                        : achievement.count + 1;
                    achievement.date = achievement.date || new Date().toISOString();
                    
                    // Guardar en localStorage con clave basada en IP
                    const storageKey = getAchievementsStorageKey();
                    const savedAchievements = localStorage.getItem(storageKey);
                    let allAchievements = [];
                    
                    if (savedAchievements) {
                        try {
                            allAchievements = JSON.parse(savedAchievements);
                            
                            // Actualizar o añadir el logro
                            const existingIndex = allAchievements.findIndex(a => a.id === achievementId);
                            if (existingIndex >= 0) {
                                allAchievements[existingIndex] = {
                                    id: achievement.id,
                                    unlocked: achievement.unlocked,
                                    count: achievement.count,
                                    date: achievement.date
                                };
                            } else {
                                allAchievements.push({
                                    id: achievement.id,
                                    unlocked: achievement.unlocked,
                                    count: achievement.count,
                                    date: achievement.date
                                });
                            }
                        } catch (error) {
                            console.error('Error al actualizar logros:', error);
                            allAchievements = [{
                                id: achievement.id,
                                unlocked: achievement.unlocked,
                                count: achievement.count,
                                date: achievement.date
                            }];
                        }
                    } else {
                        allAchievements = [{
                            id: achievement.id,
                            unlocked: achievement.unlocked,
                            count: achievement.count,
                            date: achievement.date
                        }];
                    }
                    
                    // Guardar en localStorage con clave basada en IP
                    localStorage.setItem(storageKey, JSON.stringify(allAchievements));
                    console.log(`Logro "${achievement.title}" guardado para IP: ${userIP}`);
                    
                    // Mostrar notificación si no está en modo silencioso
                    if (!silent) {
                        showAchievementNotification(
                            '¡Logro desbloqueado!', 
                            `Has conseguido el logro "${achievement.title}"`
                        );
                    }
                    
                    // Actualizar la interfaz si estamos en la pestaña de logros
                    const achievementsTab = document.querySelector('.tab[data-tab="achievements"]');
                    if (achievementsTab && achievementsTab.classList.contains('active')) {
                        const activeFilter = document.querySelector('.achievement-filter.active');
                        const category = activeFilter ? activeFilter.getAttribute('data-category') : 'all';
                        loadAchievements(category);
                    }
                    
                    return true;
                }
                
                return false;
            };
            
            // Configurar los filtros de categoría
            const filters = document.querySelectorAll('.achievement-filter');
            filters.forEach(filter => {
                filter.addEventListener('click', function() {
                    // Quitar clase activa de todos los filtros
                    filters.forEach(f => f.classList.remove('active'));
                    // Añadir clase activa al filtro actual
                    this.classList.add('active');
                    // Cargar logros filtrados
                    loadAchievements(this.dataset.category);
                });
            });
            
            // Inicializar: obtener IP y luego cargar logros
            getUserIP();
        });
    </script>
</body>
</html>
