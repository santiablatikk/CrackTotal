<!DOCTYPE html>
<html lang="es" data-theme="dark">
<head>
    <!-- ===== GOOGLE ANALYTICS & CONSENT ===== -->
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('consent', 'default', {
            'ad_storage': 'denied',
            'analytics_storage': 'denied',
            'ad_user_data': 'denied',
            'ad_personalization': 'denied',
            'functionality_storage': 'denied',
            'personalization_storage': 'denied',
            'security_storage': 'granted',
            'wait_for_update': 500
        });
        gtag('set', 'ads_data_redirection', true);
        gtag('set', 'url_passthrough', true);
        gtag('set', 'region', 'ES');
    </script>

    <!-- ===== CRITICAL META TAGS ===== -->
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="theme-color" content="#007bff">
    <meta name="color-scheme" content="dark light">
    <meta name="google-adsense-account" content="ca-pub-9579152019412427">
    
    <!-- ===== SEO META TAGS ===== -->
    <title>{{PAGE_TITLE}} - Crack Total</title>
    <meta name="description" content="{{PAGE_DESCRIPTION}}">
    <meta name="keywords" content="fútbol, trivia, juegos, argentina, crack total, {{PAGE_KEYWORDS}}">
    <meta name="author" content="Crack Total">
    <meta name="robots" content="index, follow">
    <link rel="canonical" href="https://cracktotal.com/{{PAGE_URL}}">
    
    <!-- ===== OPEN GRAPH ===== -->
    <meta property="og:type" content="{{OG_TYPE}}">
    <meta property="og:url" content="https://cracktotal.com/{{PAGE_URL}}">
    <meta property="og:title" content="{{PAGE_TITLE}} - Crack Total">
    <meta property="og:description" content="{{PAGE_DESCRIPTION}}">
    <meta property="og:image" content="https://cracktotal.com/assets/images/{{OG_IMAGE}}">
    <meta property="og:site_name" content="Crack Total">
    <meta property="og:locale" content="es_AR">

    <!-- ===== TWITTER CARDS ===== -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:site" content="@cracktotal_">
    <meta name="twitter:creator" content="@cracktotal_">
    <meta name="twitter:title" content="{{PAGE_TITLE}} - Crack Total">
    <meta name="twitter:description" content="{{PAGE_DESCRIPTION}}">
    <meta name="twitter:image" content="https://cracktotal.com/assets/images/{{OG_IMAGE}}">

    <!-- ===== FAVICONS & PWA ===== -->
    <link rel="icon" href="/portada.ico?v=202505272312" type="image/x-icon">
    <link rel="apple-touch-icon" sizes="180x180" href="/assets/images/portada.jpg">
    <link rel="manifest" href="/config/manifest.json">
    
    <!-- ===== PRELOAD CRITICAL RESOURCES ===== -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link rel="preconnect" href="https://www.google-analytics.com">
    <link rel="preconnect" href="https://firestore.googleapis.com">
    <link rel="dns-prefetch" href="https://www.googletagmanager.com">
    <link rel="dns-prefetch" href="https://pagead2.googlesyndication.com">

    <!-- ===== CRITICAL CSS INLINE ===== -->
    <style>
        /* Critical CSS for immediate rendering */
        :root {
            --primary: #007bff;
            --primary-light: #4da6ff;
            --primary-dark: #0056b3;
            --background: #0a0a0a;
            --background-alt: #161616;
            --text: #ffffff;
            --text-light: #cccccc;
            --border: rgba(255, 255, 255, 0.1);
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: 'Montserrat', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: var(--background);
            color: var(--text);
            line-height: 1.6;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }

        .app-header {
            background: var(--background);
            padding: 1rem;
            text-align: center;
            position: relative;
            z-index: 100;
        }

        .title-text {
            color: var(--primary-light);
            font-size: 2rem;
            margin: 0;
            font-weight: 700;
        }

        .subtitle {
            color: var(--text-light);
            margin-top: 0.5rem;
        }

        /* Loading skeleton */
        .skeleton {
            background: linear-gradient(90deg, #333 25%, #444 50%, #333 75%);
            background-size: 200% 100%;
            animation: loading 1.5s infinite;
            border-radius: 4px;
        }

        @keyframes loading {
            0% { background-position: 200% 0; }
            100% { background-position: -200% 0; }
        }

        /* Smooth theme transitions */
        .theme-transitioning,
        .theme-transitioning * {
            transition: background-color 0.3s ease,
                       color 0.3s ease,
                       border-color 0.3s ease !important;
        }

        /* Skip link for accessibility */
        .skip-link {
            position: absolute;
            top: -40px;
            left: 6px;
            background: var(--primary);
            color: white;
            padding: 8px;
            text-decoration: none;
            border-radius: 0 0 4px 4px;
            z-index: 1000;
        }

        .skip-link:focus {
            top: 0;
        }

        /* Critical responsive */
        @media (max-width: 768px) {
            .title-text {
                font-size: 1.5rem;
            }
        }
    </style>

    <!-- ===== PRELOAD FONTS ===== -->
    <link rel="preload" href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;600;700;800&family=Oswald:wght@400;700&display=swap" as="style" onload="this.onload=null;this.rel='stylesheet'">
    <noscript><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;600;700;800&family=Oswald:wght@400;700&display=swap"></noscript>

    <!-- ===== NON-CRITICAL CSS (ASYNC LOADED) ===== -->
    <link rel="preload" href="assets/css/critical.css?v=202505272312" as="style" onload="this.onload=null;this.rel='stylesheet'">
    <link rel="preload" href="assets/css/base.css?v=202505272312" as="style" onload="this.onload=null;this.rel='stylesheet'">
    <link rel="preload" href="assets/css/layout.css?v=202505272312" as="style" onload="this.onload=null;this.rel='stylesheet'">
    <link rel="preload" href="assets/css/performance.css?v=202505272312" as="style" onload="this.onload=null;this.rel='stylesheet'">
    <link rel="preload" href="assets/css/{{PAGE_SPECIFIC_CSS}}.css?v=202505272312" as="style" onload="this.onload=null;this.rel='stylesheet'">
    
    <!-- ===== FONT AWESOME (ASYNC) ===== -->
    <link rel="preload" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'">

    <!-- ===== SCHEMA.ORG MARKUP ===== -->
    <script type="application/ld+json">
    {
        "@context": "https://schema.org",
        "@type": "{{SCHEMA_TYPE}}",
        "name": "{{PAGE_TITLE}} - Crack Total",
        "description": "{{PAGE_DESCRIPTION}}",
        "url": "https://cracktotal.com/{{PAGE_URL}}",
        "inLanguage": "es-AR",
        "publisher": {
            "@type": "Organization",
            "name": "Crack Total",
            "logo": {
                "@type": "ImageObject",
                "url": "https://cracktotal.com/assets/images/logo.png"
            }
        },
        "mainEntity": {
            "@type": "Game",
            "name": "Crack Total",
            "description": "La plataforma definitiva de trivias de fútbol",
            "genre": "Trivia",
            "gamePlatform": "Web",
            "operatingSystem": "Any",
            "applicationCategory": "Game"
        }
    }
    </script>

    <!-- ===== GOOGLE ADSENSE ===== -->
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-9579152019412427" crossorigin="anonymous"></script>

    <!-- ===== GOOGLE ANALYTICS ===== -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-5XP3T1RTH7"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'G-5XP3T1RTH7', {
            page_title: '{{PAGE_TITLE}}',
            page_location: 'https://cracktotal.com/{{PAGE_URL}}',
            custom_map: {'custom_parameter_1': 'page_type'}
        });
    </script>

    <!-- ===== CRITICAL JAVASCRIPT (INLINE) ===== -->
    <script>
        // Critical performance monitoring
        window.CrackTotalPerf = {
            marks: {},
            mark: function(name) {
                this.marks[name] = performance.now();
            },
            measure: function(name, startMark) {
                const duration = performance.now() - this.marks[startMark];
                console.log(`📊 ${name}: ${duration.toFixed(2)}ms`);
                return duration;
            }
        };
        
        // Mark page start
        window.CrackTotalPerf.mark('page_start');

        // Theme detection and application
        (function() {
            const savedTheme = localStorage.getItem('crackTotalTheme');
            if (savedTheme) {
                try {
                    const themeData = JSON.parse(savedTheme);
                    document.documentElement.setAttribute('data-theme', themeData.currentTheme || 'dark');
                } catch (e) {
                    document.documentElement.setAttribute('data-theme', 'dark');
                }
            }
        })();

        // Service Worker registration
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', function() {
                navigator.serviceWorker.register('/sw.js')
                    .then(function(registration) {
                        console.log('✅ SW registered successfully');
                    })
                    .catch(function(error) {
                        console.log('❌ SW registration failed:', error);
                    });
            });
        }

        // Error tracking
        window.addEventListener('error', function(event) {
            if (window.gtag) {
                gtag('event', 'exception', {
                    description: event.error?.message || 'Unknown error',
                    fatal: false
                });
            }
            console.error('🚨 Global error:', event.error);
        });

        // Unhandled promise rejections
        window.addEventListener('unhandledrejection', function(event) {
            if (window.gtag) {
                gtag('event', 'exception', {
                    description: event.reason?.message || 'Unhandled promise rejection',
                    fatal: false
                });
            }
            console.error('🚨 Unhandled promise rejection:', event.reason);
        });
    </script>
</head>

<body class="{{BODY_CLASS}}" data-page="{{PAGE_NAME}}">
    <!-- ===== SKIP LINK FOR ACCESSIBILITY ===== -->
    <a href="#main-content" class="skip-link">Saltar al contenido principal</a>
    
    <!-- ===== LOADING INDICATOR ===== -->
    <div id="global-loading" class="global-loading" style="display: none;">
        <div class="loading-spinner"></div>
        <p>Cargando...</p>
    </div>

    <!-- ===== OFFLINE INDICATOR ===== -->
    <div id="offline-indicator" class="offline-indicator" style="display: none;">
        <i class="fas fa-wifi-slash"></i>
        <span>Sin conexión a internet</span>
    </div>

    <!-- ===== MAIN NAVIGATION ===== -->
    <nav class="main-navigation" role="navigation" aria-label="Navegación principal">
        <div class="nav-container">
            <a href="index.html" class="nav-logo" aria-label="Crack Total - Inicio">
                <span class="logo-text">Crack Total</span>
                <i class="fas fa-futbol logo-icon" aria-hidden="true"></i>
            </a>
            
            <button class="nav-toggle" aria-label="Abrir menú de navegación" aria-expanded="false">
                <span class="hamburger"></span>
                <span class="hamburger"></span>
                <span class="hamburger"></span>
            </button>
            
            <div class="nav-menu">
                <ul class="nav-list" role="list">
                    <li><a href="index.html" class="nav-link" data-page="home">
                        <i class="fas fa-home" aria-hidden="true"></i>
                        <span>Inicio</span>
                    </a></li>
                    <li><a href="games.html" class="nav-link" data-page="games">
                        <i class="fas fa-gamepad" aria-hidden="true"></i>
                        <span>Juegos</span>
                    </a></li>
                    <li><a href="profile.html" class="nav-link" data-page="profile">
                        <i class="fas fa-user" aria-hidden="true"></i>
                        <span>Perfil</span>
                    </a></li>
                    <li><a href="ranking.html" class="nav-link" data-page="ranking">
                        <i class="fas fa-trophy" aria-hidden="true"></i>
                        <span>Rankings</span>
                    </a></li>
                    <li><a href="logros.html" class="nav-link" data-page="achievements">
                        <i class="fas fa-medal" aria-hidden="true"></i>
                        <span>Logros</span>
                    </a></li>
                    <li><a href="blog.html" class="nav-link" data-page="blog">
                        <i class="fas fa-blog" aria-hidden="true"></i>
                        <span>Blog</span>
                    </a></li>
                </ul>
                
                <!-- Theme Selector Button -->
                <button class="theme-toggle-btn" id="theme-toggle" aria-label="Cambiar tema">
                    <i class="fas fa-palette" aria-hidden="true"></i>
                </button>
                
                <!-- Settings Button -->
                <button class="settings-btn" id="settings-toggle" aria-label="Configuración">
                    <i class="fas fa-cog" aria-hidden="true"></i>
                </button>
            </div>
        </div>
    </nav>

    <!-- ===== APP HEADER ===== -->
    <header class="app-header">
        <div class="header-container">
            <a href="index.html" class="home-link" aria-label="Volver al Inicio">
                <i class="fas fa-home"></i>
                <span>Inicio</span>
            </a>
            
            <div class="logo-animation">
                <i class="fas fa-futbol ball-icon" aria-hidden="true"></i>
            </div>
            
            <div class="header-content">
                <a href="games.html" class="title-link">
                    <h1 class="title-text">Crack Total</h1>
                </a>
                <p class="subtitle">{{PAGE_SUBTITLE}}</p>
            </div>
            
            <div class="header-actions">
                <!-- Online Status -->
                <div class="online-status" id="online-status" aria-label="Estado de conexión">
                    <i class="fas fa-wifi"></i>
                </div>
                
                <!-- Notifications Button -->
                <button class="notifications-btn" id="notifications-btn" aria-label="Notificaciones">
                    <i class="fas fa-bell"></i>
                    <span class="notification-badge" id="notification-badge" style="display: none;">0</span>
                </button>
            </div>
        </div>
    </header>

    <!-- ===== MAIN CONTENT AREA ===== -->
    <div class="app-layout">
        <main id="main-content" class="main-content" role="main">
            {{MAIN_CONTENT}}
        </main>

        <!-- ===== ASIDE CONTENT (OPTIONAL) ===== -->
        <aside class="sidebar" id="sidebar" role="complementary">
            {{SIDEBAR_CONTENT}}
        </aside>
    </div>

    <!-- ===== FOOTER ===== -->
    <footer class="site-footer" role="contentinfo">
        <div class="footer-content">
            <div class="footer-links">
                <a href="index.html"><i class="fas fa-home" aria-hidden="true"></i> Inicio</a>
                <a href="blog.html"><i class="fas fa-blog" aria-hidden="true"></i> Blog</a>
                <a href="contact.html"><i class="fas fa-envelope" aria-hidden="true"></i> Contacto</a>
                <a href="cookies.html"><i class="fas fa-cookie-bite" aria-hidden="true"></i> Cookies</a>
                <a href="privacy.html"><i class="fas fa-lock" aria-hidden="true"></i> Privacidad</a>
                <a href="terminos.html"><i class="fas fa-file-contract" aria-hidden="true"></i> Términos</a>
                <a href="about.html"><i class="fas fa-info-circle" aria-hidden="true"></i> Acerca de</a>
            </div>
            
            <div class="footer-actions">
                <!-- Share Button -->
                <button class="footer-share-button" onclick="shareSite()" aria-label="Compartir sitio web">
                    <i class="fas fa-share-alt" aria-hidden="true"></i>
                    <span>Compartir</span>
                </button>
                
                <!-- Install PWA Button -->
                <button class="install-pwa-btn" id="install-pwa" style="display: none;" aria-label="Instalar aplicación">
                    <i class="fas fa-download" aria-hidden="true"></i>
                    <span>Instalar App</span>
                </button>
            </div>
            
            <div class="footer-copyright">
                <p>&copy; 2025 Crack Total. Todos los derechos reservados.</p>
                <p class="version-info">v2.1.0 - Optimizado para rendimiento</p>
            </div>
        </div>
    </footer>

    <!-- ===== NOTIFICATION CONTAINER ===== -->
    <div id="notification-container" class="notification-container" aria-live="polite" aria-atomic="true"></div>

    <!-- ===== MODAL CONTAINER ===== -->
    <div id="modal-container" class="modal-container" role="dialog" aria-hidden="true"></div>

    <!-- ===== COOKIE CONSENT BANNER ===== -->
    <div id="cookie-consent" class="cookie-consent" style="display: none;" role="banner">
        <div class="cookie-content">
            <p>Utilizamos cookies para mejorar tu experiencia. <a href="cookies.html">Más información</a></p>
            <div class="cookie-actions">
                <button id="accept-cookies" class="btn-accept">Aceptar</button>
                <button id="reject-cookies" class="btn-reject">Rechazar</button>
            </div>
        </div>
    </div>

    <!-- ===== CORE JAVASCRIPT MODULES ===== -->
    <script type="module">
        // Load core systems
        import './assets/js/state-manager.js';
        import './assets/js/security-manager.js';
        import './assets/js/theme-manager.js';
        
        // Mark systems loaded
        window.CrackTotalPerf.mark('systems_loaded');
        
        // Initialize core functionality
        document.addEventListener('DOMContentLoaded', function() {
            window.CrackTotalPerf.mark('dom_ready');
            
            // Initialize navigation
            initNavigation();
            
            // Initialize theme toggle
            initThemeToggle();
            
            // Initialize PWA install
            initPWAInstall();
            
            // Initialize offline detection
            initOfflineDetection();
            
            // Mark initialization complete
            window.CrackTotalPerf.mark('init_complete');
            window.CrackTotalPerf.measure('Total Init Time', 'page_start');
        });

        function initNavigation() {
            const navToggle = document.querySelector('.nav-toggle');
            const navMenu = document.querySelector('.nav-menu');
            
            if (navToggle && navMenu) {
                navToggle.addEventListener('click', () => {
                    const expanded = navToggle.getAttribute('aria-expanded') === 'true';
                    navToggle.setAttribute('aria-expanded', !expanded);
                    navMenu.classList.toggle('active');
                });
            }
            
            // Highlight current page
            const currentPage = document.body.dataset.page;
            const currentLink = document.querySelector(`[data-page="${currentPage}"]`);
            if (currentLink) {
                currentLink.classList.add('active');
            }
        }

        function initThemeToggle() {
            const themeToggle = document.getElementById('theme-toggle');
            if (themeToggle && window.CrackTotalTheme) {
                themeToggle.addEventListener('click', () => {
                    window.CrackTotalTheme.createThemeSelector(document.body);
                });
            }
        }

        function initPWAInstall() {
            let deferredPrompt;
            const installBtn = document.getElementById('install-pwa');
            
            window.addEventListener('beforeinstallprompt', (e) => {
                e.preventDefault();
                deferredPrompt = e;
                if (installBtn) {
                    installBtn.style.display = 'inline-flex';
                }
            });
            
            if (installBtn) {
                installBtn.addEventListener('click', async () => {
                    if (deferredPrompt) {
                        deferredPrompt.prompt();
                        const { outcome } = await deferredPrompt.userChoice;
                        if (outcome === 'accepted') {
                            console.log('✅ PWA installed');
                        }
                        deferredPrompt = null;
                        installBtn.style.display = 'none';
                    }
                });
            }
        }

        function initOfflineDetection() {
            const offlineIndicator = document.getElementById('offline-indicator');
            const onlineStatus = document.getElementById('online-status');
            
            function updateOnlineStatus() {
                const isOnline = navigator.onLine;
                
                if (offlineIndicator) {
                    offlineIndicator.style.display = isOnline ? 'none' : 'flex';
                }
                
                if (onlineStatus) {
                    onlineStatus.className = `online-status ${isOnline ? 'online' : 'offline'}`;
                    onlineStatus.querySelector('i').className = `fas fa-${isOnline ? 'wifi' : 'wifi-slash'}`;
                }
                
                // Update state if available
                if (window.CrackTotalState) {
                    window.CrackTotalState.setState('offline.isOffline', !isOnline);
                }
            }
            
            window.addEventListener('online', updateOnlineStatus);
            window.addEventListener('offline', updateOnlineStatus);
            updateOnlineStatus();
        }
    </script>

    <!-- ===== LAZY LOAD NON-CRITICAL SCRIPTS ===== -->
    <script>
        // Lazy load non-critical scripts after page load
        window.addEventListener('load', function() {
            // Load main application script
            const mainScript = document.createElement('script');
            mainScript.src = 'assets/js/main.js?v=202505272312';
            mainScript.async = true;
            document.head.appendChild(mainScript);
            
            // Load notifications system
            const notificationScript = document.createElement('script');
            notificationScript.src = 'assets/js/notifications.js?v=202505272312';
            notificationScript.async = true;
            document.head.appendChild(notificationScript);
            
            // Load cookie consent
            const cookieScript = document.createElement('script');
            cookieScript.src = 'assets/js/cookie-consent.js?v=202505272312';
            cookieScript.async = true;
            document.head.appendChild(cookieScript);
            
            // Load page-specific script if specified
            const pageScript = '{{PAGE_SPECIFIC_JS}}';
            if (pageScript && pageScript !== '{{PAGE_SPECIFIC_JS}}') {
                const script = document.createElement('script');
                script.src = `assets/js/${pageScript}.js?v=202505272312`;
                script.async = true;
                document.head.appendChild(script);
            }
            
            // Mark scripts loaded
            window.CrackTotalPerf.mark('scripts_loaded');
        });
    </script>

    <!-- ===== FALLBACK FOR NO-JS ===== -->
    <noscript>
        <div class="no-js-warning">
            <h2>JavaScript Requerido</h2>
            <p>Esta aplicación requiere JavaScript para funcionar correctamente. Por favor habilítalo en tu navegador.</p>
        </div>
        <style>
            .no-js-warning {
                position: fixed;
                top: 0;
                left: 0;
                right: 0;
                background: #ff4444;
                color: white;
                padding: 20px;
                text-align: center;
                z-index: 10000;
            }
        </style>
    </noscript>
</body>
</html> 